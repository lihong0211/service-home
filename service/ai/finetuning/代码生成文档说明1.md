# 13-Fine-tuning微调艺术 代码生成文档说明

本目录围绕**微调（Fine-tuning）**的数学基础——**矩阵分解**，包含课堂笔记和两个教学示例。

---

## 一、笔记文档：`笔记20250830.txt`

Q&A 形式的课堂笔记，核心要点：

| 主题 | 要点 |
|------|------|
| **LoRA 微调** | 在基座模型旁增加小参数量旁支（如 7B 模型约 7000 万参数），推理时加载「基座 + LoRA」 |
| **LoRA vs 蒸馏** | LoRA 是对大模型参数的近似迁移；蒸馏是把大模型能力迁移到小模型 |
| **数据量建议** | 7B 模型可先准备约 1000 条高质量样本，训练集:验证集 ≈ 7:3 |
| **数据来源** | HuggingFace、ModelScope 等 |
| **企业实践** | 多数场景用 RAG 即可，微调多用于改变风格等特殊需求 |

---

## 二、图像 SVD：`image_svd/image_svd.py`

用**奇异值分解（SVD）**演示图像压缩，对应 LoRA 中的低秩近似思想。

```python
# 核心流程
p, s, q = svd(A, full_matrices=False)  # A = P·S·Q^T
# 只保留前 k 个奇异值 → 低秩近似
get_image_feature(s, 5)   # k=5   → 高度压缩，信息损失大
get_image_feature(s, 50)  # k=50  → 中等压缩
get_image_feature(s, 500) # k=500 → 接近原图
```

**要点**：原图矩阵 A 被分解为 P·S·Q^T，只保留前 k 个奇异值相当于用低秩矩阵近似原矩阵，与 LoRA 中 ΔW = B·A 的低秩分解思想一致。

---

## 三、推荐系统 ALS：`MovieLens/ALS.py`

实现**交替最小二乘（ALS）**矩阵分解，用于协同过滤推荐。

### 3.1 Matrix 类

手写矩阵运算，包含：行/列提取、转置、单位阵、高斯消元求逆、矩阵乘法、标量乘法等。

### 3.2 ALS 类

将评分矩阵 R 分解为 R ≈ U·V^T：

```
用户-物品评分矩阵 R (m×n)
        ↓ 分解
用户矩阵 U (k×m)  ×  物品矩阵 V (k×n)
```

**训练流程**：
1. 随机初始化 U、V
2. 交替固定一方，用最小二乘更新另一方
3. 迭代若干轮，使 U·V^T 逼近 R
4. 用 RMSE 评估拟合效果

**推荐逻辑**：对用户 i，用 U[:,i]^T · V 得到对所有物品的预测分，过滤已看过的物品后取 Top-N。

### 3.3 数据与调用

- 数据：MovieLens `ratings_small.csv`（userId, movieId, rating）
- 示例：`model.fit(X, k=3, max_iter=2)`，对用户 1–12 做 Top-2 推荐

---

## 四、与微调的关系

| 概念 | 共同点 |
|------|--------|
| **SVD 图像** | 用低秩矩阵近似原矩阵，保留主要信息 |
| **ALS 推荐** | 用 U·V^T 的低秩分解近似评分矩阵 |
| **LoRA 微调** | 用 W + B·A 的低秩增量近似原权重 W |

三者都基于**低秩矩阵分解**：用少量参数近似高维矩阵，从而减少计算和存储，同时尽量保留有用信息。
